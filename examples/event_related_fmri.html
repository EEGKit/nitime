
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Neuroimaging in Python &#8212; nitime 0.9.dev documentation</title>
    <link rel="stylesheet" href="../_static/nitime.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Multitaper coherence estimation" href="multi_taper_coh.html" />
    <link rel="prev" title="Examples" href="index.html" />
  <meta name="keywords" content="nipy, neuroimaging, python, neuroscience, time
				 series">

  </head><body>
<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
 <a href="../index.html">
  <img src="../_static/nitime-banner-bg.png" alt="NIPY logo"  border="0" />
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="multi_taper_coh.html" title="Multitaper coherence estimation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Examples"
             accesskey="P">previous</a> |</li>
  <li><a href="../index.html">Nitime Home</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Nitime Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" accesskey="U">Examples</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

  
<h4> Site Navigation </h4>
  <ul>
    <li><a href="../documentation.html">Documentation</a></li>
    <li><a href="../devel/index.html">Development</a></li>
    <li><a href="../news.html">News</a></li>
  </ul>

<h4> NIPY Community </h4>
  <ul class="simple">
    <li><a class="reference external"
	href="http://nipy.sourceforge.net/">Community Home</a></li>
    <li><a class="reference external"
	href="http://nipy.sourceforge.net/software/projects/">NIPY Projects</a></li>
    <li><a class="reference external"
	href="http://mail.scipy.org/mailman/listinfo/nipy-devel">Mailing List</a></li>
    <li><a class="reference external"
	href="http://nipy.sourceforge.net/software/license/index.html">License</a></li>
  </ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Examples</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="multi_taper_coh.html"
                        title="next chapter">Multitaper coherence estimation</a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="event-related-fmri">
<span id="et-fmri"></span><span id="example-event-related-fmri"></span><h1>Event-related fMRI<a class="headerlink" href="#event-related-fmri" title="Permalink to this headline">¶</a></h1>
<p>Extracting the average time-series from one signal, time-locked to the
occurrence of some type of event in another signal is a very typical operation
in the analysis of time-series from neuroscience experiments. Therefore, we
have an additional example of this kind of analysis in <a class="reference internal" href="grasshopper.html#grasshopper"><span class="std std-ref">Auditory processing in grasshoppers</span></a></p>
<p>The following example is taken from an fMRI experiment in which a subject was
viewing a motion stimulus, while fMRI BOLD was recorded. The time-series in
this data set were extracted from motion-sensitive voxels near area MT (a
region containing motion-sensitive cells) in this subject’s brain. 6 different
kinds of trials could occur in this experiment (designating different
directions and locations of motion). The following example shows the extraction
of the time-dependent responses of the voxels in this region to the different
stimuli.</p>
<p>We start by importing modules/functions used and define some variables we will
use in the analysis:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">nitime</span>
<span class="kn">import</span> <span class="nn">nitime.timeseries</span> <span class="k">as</span> <span class="nn">ts</span>
<span class="kn">import</span> <span class="nn">nitime.analysis</span> <span class="k">as</span> <span class="nn">nta</span>
<span class="kn">import</span> <span class="nn">nitime.viz</span> <span class="k">as</span> <span class="nn">viz</span>

<span class="n">TR</span> <span class="o">=</span> <span class="mf">2.</span>
<span class="n">len_et</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># This is given in number of samples, not time!</span>
</pre></div>
</div>
<p>Next, we load the data into an array from the csv file, using <code class="docutils literal notranslate"><span class="pre">np.loadtxt</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">nitime</span><span class="o">.</span><span class="n">__path__</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_path</span><span class="p">,</span> <span class="s1">&#39;event_related_fmri.csv&#39;</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>We initialize TimeSeries objects with the data and the TR:</p>
<p>One TimeSeries is initialized for the BOLD data:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;bold&#39;</span><span class="p">],</span> <span class="n">sampling_interval</span><span class="o">=</span><span class="n">TR</span><span class="p">)</span>
</pre></div>
</div>
<p>And another one for the events (the different stimuli):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">t2</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">TimeSeries</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;events&#39;</span><span class="p">],</span> <span class="n">sampling_interval</span><span class="o">=</span><span class="n">TR</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that this example uses the EventRelated analyzer (also used in the
<a class="reference internal" href="grasshopper.html#grasshopper"><span class="std std-ref">Auditory processing in grasshoppers</span></a> example), but here, instead of providing an <code class="xref py py-class docutils literal notranslate"><span class="pre">Events</span></code>
object as input, another <code class="xref py py-class docutils literal notranslate"><span class="pre">TimeSeries</span></code> object is provided, containing an
equivalent time-series with the same dimensions as the time-series on which the
analysis is done, with ‘0’ wherever no event of interest occurred and an integer
wherever an even of interest occurred (sequential different integers for the
different kinds of events).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="n">nta</span><span class="o">.</span><span class="n">EventRelatedAnalyzer</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">len_et</span><span class="p">)</span>
</pre></div>
</div>
<p>Two different methods of the EventRelatedAnalyzer are used: <code class="xref py py-attr docutils literal notranslate"><span class="pre">E.eta</span></code>
refers to the event-triggered average of the activity and <code class="xref py py-attr docutils literal notranslate"><span class="pre">E.ets</span></code> refers
to the event-triggered standard error of the mean (where the degrees of freedom
are set by the number of trials). Note that you can also extract the
event-triggered data itself as a list, by referring instead to
<code class="xref py py-attr docutils literal notranslate"><span class="pre">E.et_data</span></code>.</p>
<p>We pass the eta and ets calculations straight into the visualization function,
which plots the result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig01</span> <span class="o">=</span> <span class="n">viz</span><span class="o">.</span><span class="n">plot_tseries</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">eta</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;BOLD (</span><span class="si">% s</span><span class="s1">ignal change)&#39;</span><span class="p">,</span> <span class="n">yerror</span><span class="o">=</span><span class="n">E</span><span class="o">.</span><span class="n">ets</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="../_images/event_related_fmri_01.png"><img alt="../_images/event_related_fmri_01.png" src="../_images/event_related_fmri_01.png" style="width: 500px;" /></a>
<p>In the following example an alternative approach is taken to calculating
the event-related activity, based on the finite impulse-response
model (see <a class="reference internal" href="#burock2000" id="id1">[Burock2000]</a> for details)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig02</span> <span class="o">=</span> <span class="n">viz</span><span class="o">.</span><span class="n">plot_tseries</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">FIR</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;BOLD (</span><span class="si">% s</span><span class="s1">ignal change)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="../_images/event_related_fmri_02.png"><img alt="../_images/event_related_fmri_02.png" src="../_images/event_related_fmri_02.png" style="width: 500px;" /></a>
<p>Yet another method is based on a cross-correlation performed in the frequency
domain (thanks to Lavi Secundo for providing a previous implementation of this
idea). This method can speed up calculation substantially for long time-series,
because the calculation is done using a vector multiplication in the frequency
domain representation of the time-series, instead of a more computationally
expensive convolution-like operation</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig03</span> <span class="o">=</span> <span class="n">viz</span><span class="o">.</span><span class="n">plot_tseries</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">xcorr_eta</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;BOLD (</span><span class="si">% s</span><span class="s1">ignal change)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference external image-reference" href="../_images/event_related_fmri_03.png"><img alt="../_images/event_related_fmri_03.png" src="../_images/event_related_fmri_03.png" style="width: 500px;" /></a>
<p>We call plt.show() in order to display all the figures:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils citation" frame="void" id="burock2000" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[Burock2000]</a></td><td>M.A. Burock and A.M.Dale (2000). Estimation and Detection of
Event-Related fMRI Signals with Temporally Correlated Noise: A
Statistically Efficient and Unbiased Approach. Human Brain Mapping,
11:249-260</td></tr>
</tbody>
</table>
<div class="admonition-example-source-code admonition">
<p class="first admonition-title">Example source code</p>
<p class="last">You can download <a class="reference download internal" download="" href="../_downloads/68e2f9b2088d58e66f8e8f713d1b966d/event_related_fmri.py"><code class="xref download docutils literal notranslate"><span class="pre">the</span> <span class="pre">full</span> <span class="pre">source</span> <span class="pre">code</span> <span class="pre">of</span> <span class="pre">this</span> <span class="pre">example</span></code></a>.
This same script is also included in the Nitime source distribution under the
<code class="file docutils literal notranslate"><span class="pre">doc/examples/</span></code> directory.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="multi_taper_coh.html" title="Multitaper coherence estimation"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Examples"
             >previous</a> |</li>
  <li><a href="../index.html">Nitime Home</a> |&nbsp;</li>

          <li class="nav-item nav-item-1"><a href="../documentation.html" >Nitime Documentation</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="index.html" >Examples</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2009, Neuroimaging in Python team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>